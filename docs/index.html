<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Swedish Biodiversity Data Infrastructure Data and Resources in R • SBDI4R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Swedish Biodiversity Data Infrastructure Data and Resources in R">
<meta property="og:description" content="SBDI provides tools to enable users of biodiversity 
    information to find, access, combine and visualise Swedish data on
    plants, animals and fungi; these have been made available from
    &lt;https://bioatlas.se/&gt;. SBDI4R provides a subset of the tools based on the 
    ALA4R package, and a few functions custom made for Sweden, which can be 
    directly used within R. It enables the R community to directly access data 
    and resources hosted by the SBDI. Our goal is to enable observations 
    of species to be queried, and output in a range of standard formats.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">SBDI4R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/SBDI4R.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biodiversitydata-se/SBDI4R">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="sbdi4r" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#sbdi4r" class="anchor"></a>SBDI4R</h1></div>

<p>R functionality for SBDI data portal</p>
<p>The Swedish Biodiversity Data Infrastructure (SBDI) provides tools to enable users of biodiversity information to find, access, combine and visualise data on Swedish plants and animals; available through <a href="https://bioatlas.se/">Biodiversity Atlas Sweden</a>. The R package SBDI4R provides a subset of the tools, and some extension tools (found previously in Analysportalen.se), to be directly used within R.</p>
<p>SBDI4R enables the R community to directly access data and resources hosted by SBDI. Our goal is to enable observations of species to be queried and output in a range of standard formats. This tool is built on the Atlas of Living Australia <a href="https://github.com/AtlasOfLivingAustralia/ALA4R">ALA4R</a> package which provides similar services for the ALA. Similar to the <a href="https://github.com/fozy81/NBN4R">NBN4R</a> package SBDI4R wraps ALA4R functions but redirects requests to local web servers. All SBDI, NBN and ALA share similar Application Protocol Interface (API) web services.</p>
<p>The use-examples based on ALA4R are presented at the <a href="http://www.ala.org.au/blogs-news/2014-atlas-of-living-australia-science-symposium/">2014 ALA Science Symposium</a> are available in the package vignette, via (in R): <code><a href="articles/SBDI4R.html">vignette("SBDI4R")</a></code>, and a draft modifed version using NBN data is found below.</p>
<div id="installing-sbdi4r" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-sbdi4r" class="anchor"></a>Installing SBDI4R</h2>
<div id="windows" class="section level3">
<h3 class="hasAnchor">
<a href="#windows" class="anchor"></a>Windows</h3>
<p>In R:</p>
<p>Or the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(remotes)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">install_github</span>(<span class="st">"bioatlas/SBDI4R"</span>)</span></code></pre></div>
<p>If you see an error about a missing package, you will need to install it manually, e.g.:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"stringr"</span>,<span class="st">"sp"</span>))</span></code></pre></div>
<p>and then <code>install_github("bioatlas/SBDI4R")</code> again.</p>
<p>If you see an error about “ERROR: lazy loading failed for package ‘SBDI4R’”, this may be due to you trying to install on a network location. Try instead to install on a local location: first create the local location you want to use, and then specify this location for isntalling, and later loading the package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">install_github</span>(<span class="st">"bioatlas/SBDI4R"</span>, <span class="dt">lib =</span> <span class="st">"C:/pathname/MyLibrary"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SBDI4R, <span class="dt">lib.loc =</span> <span class="st">"C:/pathname/MyLibrary"</span>)</span></code></pre></div>
<p>If you wish to use the <code>data.table</code> package for potentially faster loading of data matrices (optional), also do:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"data.table"</span>)</span></code></pre></div>
</div>
<div id="linux" class="section level3">
<h3 class="hasAnchor">
<a href="#linux" class="anchor"></a>Linux</h3>
<p>First, ensure that <code>libcurl</code> is installed on your system — e.g. on Ubuntu, open a terminal and do:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">sudo</span> apt-get install libcurl4-openssl-dev</span></code></pre></div>
<p>or install <code>libcurl4-openssl-dev</code> via the Software Centre.</p>
<p>Then, in R:</p>
<p>Or the development version from GitHub:</p>
<p><code>{r eval=FALSE} install.packages("remotes") library(remotes) install_github("bioatlas/SBDI4R")</code></p>
<p>If you see an error about a missing package, you will need to install it manually, e.g.:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"stringr"</span>,<span class="st">"sp"</span>))</span></code></pre></div>
<p>and then try installing SBDI4R again.</p>
<p>If you wish to use the <code>data.table</code> package for potentially faster loading of data matrices (optional), also do:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"data.table"</span>)</span></code></pre></div>
</div>
</div>
<div id="using-sbdi4r" class="section level2">
<h2 class="hasAnchor">
<a href="#using-sbdi4r" class="anchor"></a>Using SBDI4R</h2>
<p>The SBDI4R package must be loaded for each new R session with <code><a href="https://rdrr.io/r/base/library.html">library(SBDI4R)</a></code>, or specifying your local location with <code><a href="https://rdrr.io/r/base/library.html">library(SBDI4R, lib.loc = "C:/pathname/MyLibrary")</a></code>.</p>
</div>
<div id="customizing-sbdi4r" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-sbdi4r" class="anchor"></a>Customizing SBDI4R</h2>
<p>Various aspects of the SBDI4R package can be customized.</p>
<div id="caching" class="section level3">
<h3 class="hasAnchor">
<a href="#caching" class="anchor"></a>Caching</h3>
<p>SBDI4R can cache most results to local files. This means that if the same code is run multiple times, the second and subsequent iterations will be faster. This will also reduce load on the web servers. By default, this caching is session-based, meaning that the local files are stored in a temporary directory that is automatically deleted when the R session is ended. This behaviour can be altered so that caching is permanent, by setting the caching directory to a non-temporary location. For example, under Windows, use something like:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">cache_directory =</span> <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"c:"</span>,<span class="st">"mydata"</span>,<span class="st">"sbdi_cache"</span>)) <span class="co">## Windows</span></span></code></pre></div>
<p>or for Linux:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">cache_directory =</span> <span class="st">"~/mydata/sbdi_cache"</span>) <span class="co">## Linux</span></span></code></pre></div>
<p>Note that this directory must exist (you need to create it yourself).</p>
<p>All results will be stored in that cache directory and will be used from one session to the next. They won’t be re-downloaded from the server unless the user specifically deletes those files or changes the caching setting to “refresh”.</p>
<p>If you change the cache_directory to a permanent location, you may wish to add something like this to your .Rprofile file, so that it happens automatically each time the SBDI4R package is loaded:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://rdrr.io/r/base/userhooks.html">setHook</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/userhooks.html">packageEvent</a></span>(<span class="st">"SBDI4R"</span>, <span class="st">"attach"</span>), </span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="cf">function</span>(...) <span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">cache_directory=</span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"~"</span>,<span class="st">"mydata"</span>,<span class="st">"sbdi_cache"</span>)))</span></code></pre></div>
<p>Caching can also be turned off entirely by:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">caching=</span><span class="st">"off"</span>)</span></code></pre></div>
<p>or set to “refresh”, meaning that the cached results will re-downloaded from the SBDI servers and the cache updated. (This will happen for as long as caching is set to “refresh” — so you may wish to switch back to normal “on” caching behaviour once you have updated your cache with the data you are working on).</p>
</div>
<div id="user-agent-string" class="section level3">
<h3 class="hasAnchor">
<a href="#user-agent-string" class="anchor"></a>User-agent string</h3>
<p>Each request to SBDI servers is accompanied by a “user-agent” string that identifies the software making the request. This is a standard behaviour used by web browsers as well. The user-agent identifies the user requests to SBDI, helping SBDI to adapt and enhance the services that it provides. By default, the SBDI4R user-agent string is set to “SBDI4R” plus the SBDI4R version number (e.g. “SBDI4R 1.0”).</p>
</div>
<div id="e-mail-address" class="section level3">
<h3 class="hasAnchor">
<a href="#e-mail-address" class="anchor"></a>E-mail address</h3>
<p>Each request to SBDI servers is also accompanied by an “e-mail address” string that identifies the user making the request. This is a standard behaviour used by web browsers as well. There is no default for this field. You can provide your e-mail address as a parameter directly to each call of the function occurrences(), or you can set it once per session specifying it in the package configuration:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">email=</span><span class="st">"your.valid@emailaddress.com"</span>)</span></code></pre></div>
<p><em>NO</em> other personal identification information is sent. You can see all configuration settings, including the the user-agent string that is being used, with the command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>()</span></code></pre></div>
</div>
<div id="debugging" class="section level3">
<h3 class="hasAnchor">
<a href="#debugging" class="anchor"></a>Debugging</h3>
<p>If things aren’t working as expected, more detail (particularly about web requests and caching behaviour) can be obtained by setting the verbose configuration option:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">verbose=</span><span class="ot">TRUE</span>)</span></code></pre></div>
</div>
<div id="setting-the-download-reason" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-the-download-reason" class="anchor"></a>Setting the download reason</h3>
<p>SBDI requires that you provide a reason when downloading occurrence data (via the SBDI4R <code><a href="reference/occurrences.html">occurrences()</a></code> function). You can provide this as a parameter directly to each call of <code><a href="reference/occurrences.html">occurrences()</a></code>, or you can set it once per session using:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">download_reason_id=</span>your_reason_id)</span></code></pre></div>
<p>(See <code><a href="reference/sbdi_reasons.html">sbdi_reasons()</a></code> for valid download reasons, e.g. download_reason_id=10 for “testing”, or 7 for “ecological research”, 8 for “systematic research/taxonomy”, 3 for “education”)</p>
</div>
<div id="other-options" class="section level3">
<h3 class="hasAnchor">
<a href="#other-options" class="anchor"></a>Other options</h3>
<p>If you make a request that returns an empty result set (e.g. an un-matched name), by default you will simply get an empty data structure returned to you without any special notification. If you would like to be warned about empty result sets, you can use:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="reference/sbdi_config.html">sbdi_config</a></span>(<span class="dt">warn_on_empty=</span><span class="ot">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>First, check that we have some additional packages that we’ll use in the examples, and install them if necessary.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>to_install &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"plyr"</span>,<span class="st">"phytools"</span>,<span class="st">"ape"</span>,<span class="st">"leaflet"</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>to_install &lt;-<span class="st"> </span>to_install[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(to_install, requireNamespace, <span class="dt">quietly=</span><span class="ot">TRUE</span>)]</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(to_install) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(to_install)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(plyr) </span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ape)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(phytools)</span></code></pre></div>
<div id="example-1-name-searching-and-taxonomic-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-name-searching-and-taxonomic-trees" class="anchor"></a>Example 1: Name searching and taxonomic trees</h3>
<p>We want to look at the taxonomy of titmice, but we don’t know what the correct scientific name is, so let’s search for it:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>sx &lt;-<span class="st"> </span><span class="kw"><a href="reference/search_fulltext.html">search_fulltext</a></span>(<span class="st">"parus"</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a>(sx<span class="op">$</span>data[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span>)])</span></code></pre></div>
<pre><code>#                    name             species speciesGuid    rank
# 1  Parus Linnaeus, 1758                &lt;NA&gt;        &lt;NA&gt;   genus
# 2        Parus dichrous      Parus dichrous     5788759 species
# 3     Neuroctenus parus   Neuroctenus parus    10213928 species
# 4         Parus elegans       Parus elegans     5788758 species
# 5   Parus rubidiventris Parus rubidiventris     5788753 species
# 6        Parus borealis      Parus borealis     8786895 species
# 7      Parus salicarius    Parus salicarius     9104351 species
# 8   Parus superciliosus Parus superciliosus     5788752 species
# 9        Parus amabilis      Parus amabilis     5788755 species
# 10   Parus rufonuchalis  Parus rufonuchalis     5788756 species</code></pre>
<p>But we see some e.g. insects (<strong>Neuroctenus parus</strong>) are also returned. We want to restrict the search to Paridae.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>sx &lt;-<span class="st"> </span><span class="kw"><a href="reference/search_fulltext.html">search_fulltext</a></span>(<span class="st">"parus"</span>, <span class="dt">fq=</span><span class="st">"family_s:Paridae"</span>)</span>
<span id="cb21-2"><a href="#cb21-2"></a>(sx<span class="op">$</span>data[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span>)])</span></code></pre></div>
<p>To restrict the query specifically to birds we can also use the fq argument to filter the query (see sbdi_fields(“general”,as_is=TRUE) for all the fields that are queryable), and increase page_size to include more records (default=10):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>sx &lt;-<span class="st"> </span><span class="kw"><a href="reference/search_fulltext.html">search_fulltext</a></span>(<span class="st">"parus"</span>, <span class="dt">fq=</span><span class="st">"class_s:Aves"</span>, <span class="dt">page_size=</span><span class="dv">100</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>(sx<span class="op">$</span>data[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="st">"name"</span>,<span class="st">"species"</span>, <span class="st">"speciesGuid"</span>, <span class="st">"rank"</span>)])</span></code></pre></div>
<p>Now we can download the taxonomic data (note that the search is case-sensitive):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>tx &lt;-<span class="st"> </span><span class="kw"><a href="reference/taxinfo_download.html">taxinfo_download</a></span>(<span class="st">"family_s:Paridae"</span>, <span class="dt">fields=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"guid"</span>, <span class="st">"genus_s"</span>, <span class="st">"scientificName"</span>, <span class="st">"rank"</span>))</span>
<span id="cb23-2"><a href="#cb23-2"></a>tx &lt;-<span class="st"> </span>tx[tx<span class="op">$</span>rank <span class="op">==</span><span class="st"> "species"</span>,] <span class="co">## restrict to species</span></span></code></pre></div>
<p>We can make a taxonomic tree plot using the <code>phytools</code> package:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">## as.phylo requires the taxonomic columns to be factors</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>tx<span class="op">$</span>genusS&lt;-<span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(tx<span class="op">$</span>genusS)</span>
<span id="cb24-3"><a href="#cb24-3"></a>tx<span class="op">$</span>scientificName&lt;-<span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(tx<span class="op">$</span>scientificName)</span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co">## create phylo object of Scientific.Name nested within Genus</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>ax &lt;-<span class="st"> </span><span class="kw">as.phylo</span>(<span class="op">~</span>genusS<span class="op">/</span>scientificName, <span class="dt">data=</span>tx)</span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="kw">plotTree</span>(ax, <span class="dt">fsize=</span><span class="fl">0.7</span>, <span class="dt">ftype=</span><span class="st">"i"</span>) <span class="co">## plot it</span></span></code></pre></div>
</div>
<div id="example-2-get-some-data-quality-assertions-plotting-data-on-a-map-and-save-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-get-some-data-quality-assertions-plotting-data-on-a-map-and-save-data" class="anchor"></a>Example 2: Get some data, quality assertions, plotting data on a map and save data</h3>
<p>Download occurrence data for the Blunt-fruited Water-starwort and view top of the data table:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="reference/occurrences.html">occurrences</a></span>(<span class="dt">taxon=</span><span class="st">"Callitriche cophocarpa"</span>, <span class="dt">download_reason_id=</span><span class="dv">10</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(x<span class="op">$</span>data)</span></code></pre></div>
<div id="quality-assertions" class="section level4">
<h4 class="hasAnchor">
<a href="#quality-assertions" class="anchor"></a>Quality assertions</h4>
<p>Data quality assertions are a suite of fields that are the result of a set of tests performed on data. We continue using the data for the Blunt-fruited Water-starwort and get a summary of the data quality assertions:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(x)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co"># number of original names: 3 </span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co"># number of taxonomically corrected names: 1 </span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co"># number of observation records: 5634 </span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co"># number of assertions listed: 16  -- ones with flagged issues are listed below</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">#   invalidCollectionDate: 45 records </span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#   zeroCoordinates: 2 records -- considered fatal</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">#   incompleteCollectionDate: 271 records </span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">#   unrecognisedInstitutionCode: 1732 records </span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co">#   uncertaintyRangeMismatch: 1 records </span></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="co">#   firstOfYear: 24 records </span></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="co">#   zeroLatitude: 2 records -- considered fatal</span></span>
<span id="cb26-14"><a href="#cb26-14"></a><span class="co">#   geodeticDatumAssumedWgs84: 5034 records </span></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="co">#   unrecognisedCollectionCode: 1732 records </span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">#   uncertaintyInPrecision: 81 records </span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">#   countryCoordinateMismatch: 2 records </span></span>
<span id="cb26-18"><a href="#cb26-18"></a><span class="co">#   assumedPresentOccurrenceStatus: 1180 records </span></span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="co">#   zeroLongitude: 2 records -- considered fatal</span></span>
<span id="cb26-20"><a href="#cb26-20"></a><span class="co">#   idPreOccurrence: 4 records </span></span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="co">#   recordedByUnparsable: 3 records </span></span>
<span id="cb26-22"><a href="#cb26-22"></a><span class="co">#   firstOfMonth: 131 records</span></span></code></pre></div>
<p>You can see a list of all record issues using <code><a href="reference/sbdi_fields.html">sbdi_fields("assertions",as_is=TRUE)</a></code> and see what is considered as fatal quality issues.</p>
</div>
<div id="plotting-data-on-a-map" class="section level4">
<h4 class="hasAnchor">
<a href="#plotting-data-on-a-map" class="anchor"></a>Plotting data on a map</h4>
<p>You can quickly plot all the observations with the function <code>ocurrence_plot()</code>, here we specify to map all fatal issues:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw"><a href="reference/occurrences_plot.html">occurrences_plot</a></span>(x, <span class="st">"obsPlot.pdf"</span>, <span class="dt">qa=</span><span class="st">"fatal"</span>, </span>
<span id="cb27-2"><a href="#cb27-2"></a>                  <span class="dt">grouped=</span><span class="ot">FALSE</span>, <span class="dt">taxon_level=</span><span class="st">"species"</span>, </span>
<span id="cb27-3"><a href="#cb27-3"></a>                  <span class="dt">pch=</span><span class="st">'+'</span>)</span></code></pre></div>
<p>Note that the plot is saved to a pdf file in the current working directory. You can find that by <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>.</p>
<p><img src="https://github.com/biodiversitydata-se/SBDI4R/tree/master/man/figures/obsPlot_CallitricheCophocarpa.png"></p>
<p>There are many other ways of producing spatial plots in R. The <code>leaflet</code> package provides a simple method of producing browser-based maps with panning, zooming, and background layers:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(leaflet)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">## drop any records with missing lat/lon values</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>x<span class="op">$</span>data &lt;-<span class="st"> </span>x<span class="op">$</span>data[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(x<span class="op">$</span>data<span class="op">$</span>longitude) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(x<span class="op">$</span>data<span class="op">$</span>latitude),] </span>
<span id="cb28-4"><a href="#cb28-4"></a>xa &lt;-<span class="st"> </span><span class="kw"><a href="reference/check_assertions.html">check_assertions</a></span>(x)</span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">## columns of x corresponding to a fatal assertion</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>x_afcols &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(x<span class="op">$</span>data) <span class="op">%in%</span><span class="st"> </span>xa<span class="op">$</span>occurColnames[xa<span class="op">$</span>isFatal])</span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">## rows of x that have a fatal assertion</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>x_afrows &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(x<span class="op">$</span>data[,x_afcols], <span class="dv">1</span>, any)</span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">## which taxonIdentificationIssue assertions are present in this data?</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>these_assertions &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(x<span class="op">$</span>data)[x_afcols]</span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">## make a link to the web page for each occurrence</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>popup_link &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"&lt;a href=</span><span class="ch">\"</span><span class="st">https://records.bioatlas.se/occurrences/"</span>,</span>
<span id="cb28-13"><a href="#cb28-13"></a>                      x<span class="op">$</span>data<span class="op">$</span>id,<span class="st">"</span><span class="ch">\"</span><span class="st">&gt;Link to occurrence record&lt;/a&gt;"</span>)</span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">## colour palette</span></span>
<span id="cb28-15"><a href="#cb28-15"></a>pal &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/grep.html">sub</a></span>(<span class="st">"FF$"</span>,<span class="st">""</span>, <span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">heat.colors</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(these_assertions))))</span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="co">## map each data row to colour, depending on its assertions</span></span>
<span id="cb28-17"><a href="#cb28-17"></a>marker_colour &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"#00FF00"</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(x<span class="op">$</span>data))</span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(these_assertions)) marker_colour[x<span class="op">$</span>data[,x_afcols[k]]] &lt;-<span class="st"> </span>pal[k]</span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="co">## blank map, with imagery background</span></span>
<span id="cb28-20"><a href="#cb28-20"></a>m &lt;-<span class="st"> </span><span class="kw">addProviderTiles</span>(<span class="kw">leaflet</span>(),<span class="st">"Esri.WorldImagery"</span>)</span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co">## add markers</span></span>
<span id="cb28-22"><a href="#cb28-22"></a>m &lt;-<span class="st"> </span><span class="kw">addCircleMarkers</span>(m, x<span class="op">$</span>data<span class="op">$</span>longitude, x<span class="op">$</span>data<span class="op">$</span>latitude,  <span class="dt">radius =</span> <span class="dv">5</span>,</span>
<span id="cb28-23"><a href="#cb28-23"></a>                      <span class="dt">col=</span>marker_colour, <span class="dt">popup=</span>popup_link)</span>
<span id="cb28-24"><a href="#cb28-24"></a>m</span></code></pre></div>
</div>
<div id="save-data" class="section level4">
<h4 class="hasAnchor">
<a href="#save-data" class="anchor"></a>Save data</h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># save as data.frame</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>Callitriche &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(x<span class="op">$</span>data)</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># simplyfy data frame</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>calli &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(Callitriche<span class="op">$</span>scientificName,</span>
<span id="cb29-6"><a href="#cb29-6"></a>                   Callitriche<span class="op">$</span>latitude,</span>
<span id="cb29-7"><a href="#cb29-7"></a>                   Callitriche<span class="op">$</span>longitude)</span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co"># simplify column names</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(calli) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species"</span>,<span class="st">"latitude"</span>,<span class="st">"longitude"</span>)</span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co"># remove rows with missing values (NAs)</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>calli &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(calli)</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co"># save new dataframe</span></span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(calli,<span class="st">"Callitriche.csv"</span>)</span></code></pre></div>
</div>
</div>
<div id="example-3-summarise-occurrences-over-a-defined-grid" class="section level3">
<h3 class="hasAnchor">
<a href="#example-3-summarise-occurrences-over-a-defined-grid" class="anchor"></a>Example 3: Summarise occurrences over a defined grid</h3>
<p>Now we want to summarise occurrences over a defined grid instead of plotting every observation point. For this example you will need the <code>sp</code> and <code>rgeso</code> packages. Install them if you haven´t with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("sp", "rgeos")</a></code>. First we need to overlay the observations with the grid:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sp) <span class="co"># the function coordinates() and proj4string() are in sp</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rgeos) <span class="co">#  the function over() is in package rgeos</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">## load some shapes over Sweden</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"swe_wgs84"</span>, <span class="dt">package=</span><span class="st">"SBDI4R"</span>, <span class="dt">envir=</span><span class="kw"><a href="https://rdrr.io/r/base/environment.html">environment</a></span>()) <span class="co"># Political borders</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"swe100kmGrid"</span>, <span class="dt">package=</span><span class="st">"SBDI4R"</span>, <span class="dt">envir=</span><span class="kw"><a href="https://rdrr.io/r/base/environment.html">environment</a></span>()) <span class="co"># A grid</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>grid &lt;-<span class="st"> </span>swe100kmGrid</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">## make the observations spatial</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>obs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(x<span class="op">$</span>data)</span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="kw">coordinates</span>(obs) &lt;-<span class="st"> </span>obs[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>)]</span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="kw">proj4string</span>(obs) &lt;-<span class="st"> "+init=epsg:4326"</span></span>
<span id="cb30-12"><a href="#cb30-12"></a></span>
<span id="cb30-13"><a href="#cb30-13"></a>nObs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(obs)</span>
<span id="cb30-14"><a href="#cb30-14"></a></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co">## overlay the data with the grid</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>ObsInGridList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/plotmath.html">over</a></span>(grid, obs, <span class="dt">returnList=</span><span class="ot">TRUE</span>)</span>
<span id="cb30-17"><a href="#cb30-17"></a>wNonEmpty &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(ObsInGridList, nrow)) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) )</span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(wNonEmpty)<span class="op">==</span><span class="dv">0</span>) <span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">"Observations don't overlap any grid cell."</span>)</span>
<span id="cb30-19"><a href="#cb30-19"></a></span>
<span id="cb30-20"><a href="#cb30-20"></a><span class="co">## check nObs</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>nObsInGrid &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(ObsInGridList, nrow)))</span></code></pre></div>
<p>Now summarise occurrences within grid cells:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">## apply a summary over the grid</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>nCells &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ObsInGridList)</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="st">"nObs"</span>=<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>,nCells)),</span>
<span id="cb31-5"><a href="#cb31-5"></a>                  <span class="st">"nYears"</span>=<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>,nCells)),</span>
<span id="cb31-6"><a href="#cb31-6"></a>                  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a>cols2use&lt;-<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"scientificName"</span>, <span class="st">"year"</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a>dataRes&lt;-<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(ObsInGridList[wNonEmpty], <span class="cf">function</span>(x){</span>
<span id="cb31-11"><a href="#cb31-11"></a>  x&lt;-x[,cols2use]</span>
<span id="cb31-12"><a href="#cb31-12"></a>  <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(x) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"scientificName"</span>, <span class="st">"year"</span>)</span>
<span id="cb31-13"><a href="#cb31-13"></a>  </span>
<span id="cb31-14"><a href="#cb31-14"></a>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"nObs"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x[,<span class="st">"scientificName"</span>]),</span>
<span id="cb31-15"><a href="#cb31-15"></a>           <span class="st">"nYears"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(x[,<span class="st">"year"</span>]))</span>
<span id="cb31-16"><a href="#cb31-16"></a>  ))</span>
<span id="cb31-17"><a href="#cb31-17"></a>})</span>
<span id="cb31-18"><a href="#cb31-18"></a></span>
<span id="cb31-19"><a href="#cb31-19"></a>dataRes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(dataRes),</span>
<span id="cb31-20"><a href="#cb31-20"></a>                             <span class="dt">nrow=</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(dataRes), </span>
<span id="cb31-21"><a href="#cb31-21"></a>                             <span class="dt">byrow=</span><span class="ot">TRUE</span>),</span>
<span id="cb31-22"><a href="#cb31-22"></a>                    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb31-23"><a href="#cb31-23"></a></span>
<span id="cb31-24"><a href="#cb31-24"></a>dataRes<span class="op">$</span>X1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(dataRes<span class="op">$</span>X1)</span>
<span id="cb31-25"><a href="#cb31-25"></a>dataRes<span class="op">$</span>X2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(dataRes<span class="op">$</span>X2)</span>
<span id="cb31-26"><a href="#cb31-26"></a></span>
<span id="cb31-27"><a href="#cb31-27"></a>res[wNonEmpty,] &lt;-<span class="st"> </span>dataRes</span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(grid)</span>
<span id="cb31-29"><a href="#cb31-29"></a></span>
<span id="cb31-30"><a href="#cb31-30"></a>resSp &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sp/man/SpatialPolygons.html">SpatialPolygonsDataFrame</a></span>(grid, res)</span></code></pre></div>
<p>Finally plot the grid summary as a map:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>palBW &lt;-<span class="st"> </span>leaflet<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"white"</span>, <span class="st">"navyblue"</span>), </span>
<span id="cb32-2"><a href="#cb32-2"></a>                               <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(resSp<span class="op">@</span>data<span class="op">$</span>nObs, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)), </span>
<span id="cb32-3"><a href="#cb32-3"></a>                               <span class="dt">na.color =</span> <span class="st">"transparent"</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(resSp, <span class="dt">col=</span><span class="kw">palBW</span>(resSp<span class="op">@</span>data<span class="op">$</span>nObs), <span class="dt">border =</span> <span class="ot">NA</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(swe_wgs84<span class="op">$</span>Border, <span class="dt">border=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">1</span>, <span class="dt">add=</span>T)</span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>, </span>
<span id="cb32-7"><a href="#cb32-7"></a>       <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(resSp<span class="op">@</span>data<span class="op">$</span>nObs, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb32-8"><a href="#cb32-8"></a>       <span class="dt">col =</span> <span class="kw">palBW</span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(resSp<span class="op">@</span>data<span class="op">$</span>nObs, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">length.out =</span> <span class="dv">5</span>)),</span>
<span id="cb32-9"><a href="#cb32-9"></a>       <span class="dt">title =</span> <span class="st">"Number of observations"</span>, <span class="dt">pch =</span> <span class="dv">15</span>, <span class="dt">bty=</span><span class="st">"n"</span>)</span></code></pre></div>
</div>
</div>
<div id="more-examples---case-studies" class="section level2">
<h2 class="hasAnchor">
<a href="#more-examples---case-studies" class="anchor"></a>More examples - case studies</h2>
<div id="case-1" class="section level3">
<h3 class="hasAnchor">
<a href="#case-1" class="anchor"></a>Case 1:</h3>
<p>coming soon…</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/biodiversitydata-se/SBDI4R">https://​github.com/​biodiversitydata-se/​SBDI4R</a>
</li>
<li>Report a bug at <br><a href="https://github.com/biodiversitydata-se/SBDI4R/issues">https://​github.com/​biodiversitydata-se/​SBDI4R/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Debora Arlt <br><small class="roles"> Author, maintainer </small>  </li>
<li>Alejandro Ruete <br><small class="roles"> Author </small>  </li>
<li>Anton Hammarström <br><small class="roles"> Author </small>  </li>
<li>Marcus Lindh <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#maturing"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://travis-ci.com/biodiversitydata-se/SBDI4R"><img src="https://travis-ci.com/biodiversitydata-se/SBDI4R.svg?branch=master" alt="Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Debora Arlt, Alejandro Ruete, Anton Hammarström, Marcus Lindh.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
